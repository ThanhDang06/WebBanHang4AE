@model IEnumerable<WBH.Models.Product>
@using WBH.Helpers

@{
    ViewBag.Title = "ProductList";
    Layout = "~/Views/Shared/WBH.cshtml";
}
<link href="@Url.Content("~/Content/Main.css")" rel="stylesheet" />

<main>
    <section class="slides">
        <img src="~/Content/Img/BannerHome.png" alt="Banner quảng cáo" class="slide" style="width: 100%;" />
        <img src="~/Content/Img/BannerHome1.png" alt="Banner quảng cáo" class="slide" style="width: 100%;" />
    </section>

    <section class="section-home">
        <div class="container">
            <h1>Tất cả sản phẩm</h1>

            <form method="get" action="@Url.Action("ProductList", "Products")" class="sortby">
                <label>Sắp xếp:</label>
                <select name="sortOrder" onchange="this.form.submit()">
                    <option value="">-- Sắp xếp --</option>
                    <option value="price_asc">Giá tăng dần</option>
                    <option value="price_desc">Giá giảm dần</option>
                    <option value="name_asc">Tên A → Z</option>
                    <option value="name_desc">Tên Z → A</option>
                </select>
            </form>

            <div class="product">
                <div class="product-list">
                    <div class="product-grid">
                        @foreach (var item in Model)
                        {
                            var defaultImg = item.ProductColors.FirstOrDefault()?.Image ?? item.Image;

                            <div class="product-card" data-category="@item.Category" data-id="@item.IDProduct">
                                <div class="product-image">
                                    <a href="@Url.Action("Details", "Products", new { id = item.IDProduct })">
                                        <img id="img-@item.IDProduct"
                                             src="@Url.Content("~/Content/Img/" + defaultImg)"
                                             alt="@item.ProductName" />
                                    </a>
                                    <span class="product-badge">@((item.IsSale) ? "Sale" : "Hàng Mới")</span>

                                    <div class="product-actions">
                                        <a class="ri-eye-fill" href="@Url.Action("Details", "Products", new { id = item.IDProduct })"></a>
                                        <button class="add-to-cart" data-id="@item.IDProduct">
                                            <i class="ri-shopping-cart-2-fill"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="product-info">
                                    <h3 class="product-name">@item.ProductName</h3>
                                    <p class="product-price">@SaleHelper.DisplayPrice(item.Price)</p>

                                    @if (ViewBag.IsAdmin == true)
                                    {
                                        <p class="product-quantity">Số lượng: @item.Quantity</p>
                                    }

                                    <!-- Phần chọn màu -->
                                    @if (item.ProductColors != null && item.ProductColors.Any())
                                    {
                                        <div class="color-options">
                                            @foreach (var color in item.ProductColors)
                                            {
                                                <button class="color-btn"
                                                        style="background:@color.ColorName"
                                                        data-img="@Url.Content("~/Content/Img/" + color.Image)"
                                                        data-product="@item.IDProduct">
                                                </button>
                                            }
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const searchInput = document.getElementById('searchInput');
            const tableRows = document.querySelectorAll('table tbody tr');

            searchInput.addEventListener('keyup', function () {
                const filter = this.value.toLowerCase().trim();

                tableRows.forEach(row => {
                    // Lấy tên sản phẩm (cột thứ 2, index = 1)
                    const productName = row.cells[1].textContent.toLowerCase().trim();
                    row.style.display = productName.includes(filter) ? '' : 'none';
                });
            });
        });
    </script>
}